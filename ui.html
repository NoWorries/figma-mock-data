<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mock Accounting Data</title>
    <link rel="stylesheet" href="style.css">
    <style>body {
      background-color: var(--figma-color-bg);
      color: var(--figma-color-text);
  margin: 0;
      padding: 0;

      font-size: 12px;
      font-family: "Inter", Arial, Helvetica, sans-serif;
    }
  h2 {margin-top:0;font-size: 0.9rem; font-weight: 550;}
    button {
      padding: 8px 12px;
      margin: 0 0 8px 0;
      color: var(--figma-color-text-onbrand);
      background-color: var(--figma-color-bg-brand);
      font-family: var(--figma-text-body-medium-font-family);
    font-size: var(--figma-text-body-medium-font-size);
    font-weight: 450;
    letter-spacing: var(--figma-text-body-medium-letter-spacing);
    line-height: var(--figma-text-body-medium-line-height);
      border:none;
      border-radius: 4px;

  }
  ol {
    color: var(--figma-color-text-secondary);
    padding: 0 1rem;
    li {
      margin-bottom: 0.35em;
    }
  }
    label {
      margin-right: 10px;
      font-weight: 450;
    }
    .introduction {
      padding: 1rem 1rem 0;
    }
    .mainContent {
      padding: 1rem 1rem 0.5rem;
    }
    .secondContent {
      padding: 0rem 1rem 1rem;
    }
    .inputRow {
        display: flex;
        justify-content: space-between;
        align-items: center;
        
        input {
          font-size: 11px;
          font-weight: 450;
          border: none;
          color: var(--figma-color-text);
          fill: var(--figma-color-icon);
          border-radius: 2px;
          height: 1.5rem;
          padding-left: 7px;


        }
          
      }
      .inputField {
        input {
          font-size: 11px;
          font-weight: 450;
          border: none;
          color: var(--figma-color-text);
          fill: var(--figma-color-icon);
          border-radius: 2px;
          height: 1.5rem;
          padding-left: 7px;

          width: 16ch;
        }
      
      }
  
.spacer {
  margin-bottom:6px;
}
hr {
  margin:0;
}
    #advancedOptions {
      padding: 1rem;
      display: none;
      margin-top: 0;
      background-color: var(--figma-color-bg-secondary);

     
    }
    #totalContainer {
      margin-top: 0;
    }
    #totalValue {
      font-weight: bold;
    }
    
    .secondContent p, .secondContent .calculateTotalButton {
      font-size: 14px;
    }
    </style>
  </head>
  <body>
    <div class="introduction"><h2>Generate numbers</h2>
      <p>Insert numbers between a specific range, with options for negative values.</p>
    <ol><li>Select text layers</li>
      <li>Use advanced options to make adjustments (Optional)</li>
      <li>Press "Generate numbers" to replace data</li>
      <li>Review results, repeat if necessary</li>
      <li>Copy total to clipboard</li></ol></div>
    <div class="mainContent">
      
    <button id="generateButton">Generate numbers</button>
 
    <div class="inputRow ">
      <label for="advancedToggle">Advanced options</label>
      <input type="checkbox" id="advancedToggle" />
    </div>
  </div>
    <div id="advancedOptions">
      <div class="inputRow inputField spacer">
        <label for="numberChance">Chance of being a number or a "-" (%)</label>
        <input type="number" id="numberChance" value="50" min="0" max="100" />
      </div>
      <div class="inputRow inputField spacer">
        <label for="minValue">Minimum value</label>
        <input type="number" id="minValue" value="0" min="0" />
      </div>
      <div class="inputRow inputField spacer">
        <label for="maxValue">Maximum value</label>
        <input type="number" id="maxValue" value="50000" min="1" />
      </div>
    <div class="inputRow inputField">
      <label for="negativeChance">Chance of being negative number (%)</label>
      <input type="number" id="negativeChance" value="10" min="0" max="100" />
    </div>
  </div>
<hr>
  <div class="introduction"><h2>Calculate totals</h2>
    <ol><li>Select text layers</li>
      <li>Press "Calculate total"</li>
      <li>Copy total to clipboard</li></ol></div>
    <div id="totalContainer" class="secondContent">
      <p>Total: <span id="totalValue">0.00</span></p>
      <button id="calculateTotalButton">Calculate total</button>
      <button id="copyButton" class="secondary" style="display: none;">Copy to Clipboard</button>
    </div>

    <script>
      document.getElementById("generateButton").onclick = () => {
        const advanced = document.getElementById("advancedToggle").checked;
        const negativeChance = advanced ? parseInt(document.getElementById("negativeChance").value) : 10;
        const minValue = advanced ? parseFloat(document.getElementById("minValue").value) : 1;
        const maxValue = advanced ? parseFloat(document.getElementById("maxValue").value) : 50000;
        const numberChance = advanced ? parseInt(document.getElementById("numberChance").value) : 50;

        // Send the parameters to the plugin code
        parent.postMessage(
          {
            pluginMessage: { type: "generateData", advanced, negativeChance, minValue, maxValue, numberChance },
          },
          "*"
        );

        // Trigger total recalculation after generating data
        parent.postMessage({ pluginMessage: { type: "calculateTotal" } }, "*");
      };

      document.getElementById("calculateTotalButton").onclick = () => {
        // Trigger total calculation without generating random data
        parent.postMessage({ pluginMessage: { type: "calculateTotal" } }, "*");
      };

      document.getElementById("copyButton").onclick = () => {
        const totalValue = document.getElementById("totalValue").innerText;
        
        // Create a temporary textarea to copy the total value to clipboard
        const textarea = document.createElement('textarea');
        textarea.value = totalValue;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      };

      // Show advanced options when the checkbox is toggled
      document.getElementById("advancedToggle").onchange = () => {
        const advancedOptions = document.getElementById("advancedOptions");
        advancedOptions.style.display = document.getElementById("advancedToggle").checked ? "block" : "none";
      };

      // Listen for total updates from the plugin side
      window.onmessage = (event) => {
        const { type, total } = event.data.pluginMessage;
        if (type === "updateTotal") {
          document.getElementById("totalValue").innerText = total;
          document.getElementById("copyButton").style.display = "inline-block"; // Show copy button
        }
      };
    </script>
  </body>
</html>
